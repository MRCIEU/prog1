<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.36">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Gibran Hemani">
<meta name="dcterms.date" content="2022-12-11">

<title>Variance estimators</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="2022-12-09-mz-variance_files/libs/clipboard/clipboard.min.js"></script>
<script src="2022-12-09-mz-variance_files/libs/quarto-html/quarto.js"></script>
<script src="2022-12-09-mz-variance_files/libs/quarto-html/popper.min.js"></script>
<script src="2022-12-09-mz-variance_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="2022-12-09-mz-variance_files/libs/quarto-html/anchor.min.js"></script>
<link href="2022-12-09-mz-variance_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="2022-12-09-mz-variance_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="2022-12-09-mz-variance_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="2022-12-09-mz-variance_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="2022-12-09-mz-variance_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Variance estimators</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Gibran Hemani </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 11, 2022</p>
    </div>
  </div>
    
  </div>
  

</header>

<section id="data-generating-model" class="level2">
<h2 class="anchored" data-anchor-id="data-generating-model">Data generating model</h2>
<p><span class="math display">\[
y_i = \alpha + \beta_{1,j}G_{ij} + z_i + v_i + e_i
\]</span></p>
<p>where <span class="math inline">\(\alpha\)</span> is an intercept term, <span class="math inline">\(\beta_{1,j}\)</span> is the additive effect of SNP $j$, <span class="math inline">\(G_{i,j}\)</span> is the genotype value for individual <span class="math inline">\(i\)</span> at SNP $j$, <span class="math inline">\(z_i\)</span> is the remaining polygenic risk</p>
<p><span class="math display">\[
z_i \sim N(0, \sigma^2_{g} - 2p_j(1-p_j)\beta_{1,j}^2)
\]</span></p>
<p><span class="math inline">\(v_i\)</span> is the SNPâ€™s influence on dispersion where</p>
<p><span class="math display">\[
v_i \sim N(0, \beta_{2,j}G_{i,j})
\]</span></p>
<p>and <span class="math inline">\(e_i\)</span> is the residual variance</p>
<p><span class="math display">\[
e_i \sim N(0, 1 - \sigma^2_g - \sigma^2_v)
\]</span></p>
<p>To estimate dispersion effects amongst unrelateds use the deviation regression model (DRM) from Marderstein et al 2021 AJHG (<a href="https://doi.org/10.1016/j.ajhg.2020.11.016" class="uri">https://doi.org/10.1016/j.ajhg.2020.11.016</a>).</p>
<p>To estimate variance heterogeneity effects using MZs, simply</p>
<p><span class="math display">\[
|y_{i,A} - y_{i,B}| = \hat{\beta}_{2,j}G_{i,j} + \epsilon_i
\]</span></p>
<p>where A and B represent the individuals in the MZ pair.</p>
<p>To estimate variance heterogeneity effects using siblings, it is identical to the MZ method but restricted to sibling pairs who have identity by state value of 2 (i.e.&nbsp;share the same genotype value at the SNP being tested).</p>
</section>
<section id="simulations" class="level2">
<h2 class="anchored" data-anchor-id="simulations">Simulations</h2>
<div class="cell" data-hash="2022-12-09-mz-variance_cache/html/unnamed-chunk-1_8dc4717b635fe95c5a2abd1b58877c5b">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Method for simulating dispersion effects in unrelated individuals</p>
<div class="cell" data-hash="2022-12-09-mz-variance_cache/html/unnamed-chunk-2_4bc89533dedf80f42ed598fde8cadcc3">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>sim_pop <span class="ot">&lt;-</span> <span class="cf">function</span>(n, beta1, beta2, af, h2)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  g <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">2</span>, af)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  prs <span class="ot">&lt;-</span> g <span class="sc">*</span> beta1</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  vg <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, h2)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  v <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, beta2 <span class="sc">*</span> g)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  ve <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="fu">var</span>(vg) <span class="sc">-</span> <span class="fu">var</span>(v) <span class="sc">-</span> <span class="fu">var</span>(prs)))</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> prs <span class="sc">+</span> v <span class="sc">+</span> vg <span class="sc">+</span> ve</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">tibble</span>(</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    g, y</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">sim_pop</span>(<span class="dv">100000</span>, <span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">0.3</span>, <span class="fl">0.1</span>)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(a)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           g          y
g 0.41881431 0.04145241
y 0.04145241 1.00183156</code></pre>
</div>
</div>
<p>Method for simulating dispersion effects in monozogytic twins</p>
<div class="cell" data-hash="2022-12-09-mz-variance_cache/html/unnamed-chunk-3_6fab5f6a48a93ccc270559286d6459f9">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>sim_mz <span class="ot">&lt;-</span> <span class="cf">function</span>(n, beta1, beta2, af, h2)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  g <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">2</span>, af)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  prs <span class="ot">&lt;-</span> g <span class="sc">*</span> beta1</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  vg <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, h2)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  v1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, beta2 <span class="sc">*</span> g)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  ve1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="fu">var</span>(vg) <span class="sc">-</span> <span class="fu">var</span>(v1) <span class="sc">-</span> <span class="fu">var</span>(prs)))</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  y1 <span class="ot">&lt;-</span> prs <span class="sc">+</span> v1 <span class="sc">+</span> vg <span class="sc">+</span> ve1</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  v2 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, beta2 <span class="sc">*</span> g)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  ve2 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="fu">var</span>(vg) <span class="sc">-</span> <span class="fu">var</span>(v2) <span class="sc">-</span> <span class="fu">var</span>(prs)))</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  y2 <span class="ot">&lt;-</span> prs <span class="sc">+</span> v2 <span class="sc">+</span> vg <span class="sc">+</span> ve2</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">tibble</span>(</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    g, y1, y2</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">sim_mz</span>(<span class="dv">100000</span>, <span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">0.3</span>, <span class="fl">0.1</span>)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(a)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            g         y1         y2
g  0.41789069 0.04179887 0.04360385
y1 0.04179887 1.00074619 0.01158774
y2 0.04360385 0.01158774 0.99856453</code></pre>
</div>
</div>
<p>See what dispersion looks like from this simulation</p>
<div class="cell" data-hash="2022-12-09-mz-variance_cache/html/unnamed-chunk-4_fa0c01a8be68d8be23ea4dc706951c55">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>a <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(., <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">as.factor</span>(g), <span class="at">y=</span>y1)) <span class="sc">+</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2022-12-09-mz-variance_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Summarise the dispersion. Note - how would you scale it to the MZ pair mean?</p>
<div class="cell" data-hash="2022-12-09-mz-variance_cache/html/unnamed-chunk-5_d9e96c25d72b19498cd7f679b92aa12b">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">sim_mz</span>(<span class="dv">100000</span>, <span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">0.3</span>, <span class="fl">0.8</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>a <span class="sc">%&gt;%</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(g) <span class="sc">%&gt;%</span> </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">m=</span><span class="fu">mean</span>(y1), </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">v=</span><span class="fu">var</span>(y1), </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">mzv=</span><span class="fu">mean</span>(<span class="fu">abs</span>(y1<span class="sc">-</span>y2))</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 Ã— 4
      g        m     v   mzv
  &lt;int&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1     0 -0.00271 0.795 0.456
2     1  0.102   1.06  0.724
3     2  0.211   1.83  1.21 </code></pre>
</div>
</div>
<p>Method for testing unrelateds using DRM</p>
<div class="cell" data-hash="2022-12-09-mz-variance_cache/html/unnamed-chunk-6_5319d770436701aefe132b3bf7392b09">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>test_drm <span class="ot">&lt;-</span> <span class="cf">function</span>(g, y)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  y.i <span class="ot">&lt;-</span> <span class="fu">tapply</span>(y, g, median, <span class="at">na.rm=</span>T)  </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  z.ij <span class="ot">&lt;-</span> <span class="fu">abs</span>(y <span class="sc">-</span> y.i[g<span class="sc">+</span><span class="dv">1</span>])</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(<span class="fu">lm</span>(z.ij <span class="sc">~</span> g))<span class="sc">$</span>coef <span class="sc">%&gt;%</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">method=</span><span class="st">"drm"</span>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="fu">test_drm</span>(a<span class="sc">$</span>g, a<span class="sc">$</span>y1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 Ã— 5
  Estimate `Std. Error` `t value` `Pr(&gt;|t|)` method
     &lt;dbl&gt;        &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt; 
1    0.152      0.00295      51.6          0 drm   </code></pre>
</div>
</div>
<p>Method for testing using MZs</p>
<div class="cell" data-hash="2022-12-09-mz-variance_cache/html/unnamed-chunk-7_84aa23c405c190d96f4cec0d5e9a77bb">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>test_mz <span class="ot">&lt;-</span> <span class="cf">function</span>(g, y1, y2)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  yd1 <span class="ot">&lt;-</span> <span class="fu">abs</span>(y1<span class="sc">-</span>y2)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  r1 <span class="ot">&lt;-</span> <span class="fu">summary</span>(<span class="fu">lm</span>(yd1 <span class="sc">~</span> g))<span class="sc">$</span>coef <span class="sc">%&gt;%</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">method=</span><span class="st">"mzdiff"</span>)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  r1</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="fu">test_mz</span>(a<span class="sc">$</span>g, a<span class="sc">$</span>y1, a<span class="sc">$</span>y2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 Ã— 5
  Estimate `Std. Error` `t value` `Pr(&gt;|t|)` method
     &lt;dbl&gt;        &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt; 
1    0.332      0.00249      133.          0 mzdiff</code></pre>
</div>
</div>
</section>
<section id="power-simulations" class="level2">
<h2 class="anchored" data-anchor-id="power-simulations">Power simulations</h2>
<p>A trait with high heritability will have vQTL (dispersion) effects that are relatively large in MZs, but heritability shouldnâ€™t have a major part to play in unrelateds for estimating vQTL effects.</p>
<p>Start with simulations where population is compared against mz and n pop = n mz pairs.</p>
<div class="cell" data-hash="2022-12-09-mz-variance_cache/html/unnamed-chunk-8_070d8a77764839d1009607d6ddaba37b">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta1 =</span> <span class="dv">0</span>,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta2 =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="at">by=</span><span class="fl">0.01</span>),</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">h2 =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>),</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">af =</span> <span class="fl">0.3</span>,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">10000</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(param)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 102   5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>res1 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(param), <span class="cf">function</span>(i)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">&lt;-</span> <span class="fu">do.call</span>(sim_mz, param[i,])</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">any</span>(<span class="fu">is.na</span>(a<span class="sc">$</span>y1)) <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(a<span class="sc">$</span>y2)))</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">test_mz</span>(a<span class="sc">$</span>g, a<span class="sc">$</span>y1, a<span class="sc">$</span>y2),</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">test_drm</span>(a<span class="sc">$</span>g, a<span class="sc">$</span>y1)</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_cols</span>(., param[i,])</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">%&gt;%</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="2022-12-09-mz-variance_cache/html/unnamed-chunk-9_a9dfbc0d4d857526082e53d3fd855a60">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>res1 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(n<span class="sc">==</span><span class="dv">10000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(., <span class="fu">aes</span>(<span class="at">x=</span>beta2, <span class="at">y=</span><span class="sc">-</span><span class="fu">log10</span>(<span class="st">`</span><span class="at">Pr(&gt;|t|)</span><span class="st">`</span>))) <span class="sc">+</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">colour=</span>method)) <span class="sc">+</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> h2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2022-12-09-mz-variance_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>They are comparable at low heritability but as heritability increases, MZ method has a distinct advantage.</p>
<p>Now compare with more realistic sample sizes, 10k mz pairs vs 500k unrelateds</p>
<div class="cell" data-hash="2022-12-09-mz-variance_cache/html/unnamed-chunk-10_3f9069d2f90f8adff8508d1d21da0e20">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta1 =</span> <span class="dv">0</span>,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta2 =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="at">by=</span><span class="fl">0.01</span>),</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">h2 =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>),</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">af =</span> <span class="fl">0.32</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(param)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 102   4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>res2 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(param), <span class="cf">function</span>(i)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  a1 <span class="ot">&lt;-</span> <span class="fu">do.call</span>(sim_mz, param[i,] <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">n=</span><span class="dv">10000</span>))</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  a2 <span class="ot">&lt;-</span> <span class="fu">do.call</span>(sim_mz, param[i,] <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">n=</span><span class="dv">500000</span>))</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">any</span>(<span class="fu">is.na</span>(a1<span class="sc">$</span>y1)) <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(a1<span class="sc">$</span>y2)) <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(a2<span class="sc">$</span>y1)) <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(a2<span class="sc">$</span>y2)))</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">test_mz</span>(a1<span class="sc">$</span>g, a1<span class="sc">$</span>y1, a1<span class="sc">$</span>y2),</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">test_drm</span>(a2<span class="sc">$</span>g, a2<span class="sc">$</span>y1)</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_cols</span>(., param[i,])</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">%&gt;%</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in sqrt(1 - var(vg) - var(v1) - var(prs)): NaNs produced</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in rnorm(n, 0, sqrt(1 - var(vg) - var(v1) - var(prs))): NAs produced</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in sqrt(1 - var(vg) - var(v2) - var(prs)): NaNs produced</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in rnorm(n, 0, sqrt(1 - var(vg) - var(v2) - var(prs))): NAs produced</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in sqrt(1 - var(vg) - var(v1) - var(prs)): NaNs produced</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in rnorm(n, 0, sqrt(1 - var(vg) - var(v1) - var(prs))): NAs produced</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in sqrt(1 - var(vg) - var(v2) - var(prs)): NaNs produced</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in rnorm(n, 0, sqrt(1 - var(vg) - var(v2) - var(prs))): NAs produced</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in sqrt(1 - var(vg) - var(v1) - var(prs)): NaNs produced</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in rnorm(n, 0, sqrt(1 - var(vg) - var(v1) - var(prs))): NAs produced</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in sqrt(1 - var(vg) - var(v2) - var(prs)): NaNs produced</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in rnorm(n, 0, sqrt(1 - var(vg) - var(v2) - var(prs))): NAs produced</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in sqrt(1 - var(vg) - var(v1) - var(prs)): NaNs produced</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in rnorm(n, 0, sqrt(1 - var(vg) - var(v1) - var(prs))): NAs produced</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in sqrt(1 - var(vg) - var(v2) - var(prs)): NaNs produced</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in rnorm(n, 0, sqrt(1 - var(vg) - var(v2) - var(prs))): NAs produced</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in sqrt(1 - var(vg) - var(v1) - var(prs)): NaNs produced</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in rnorm(n, 0, sqrt(1 - var(vg) - var(v1) - var(prs))): NAs produced</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in sqrt(1 - var(vg) - var(v2) - var(prs)): NaNs produced</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in rnorm(n, 0, sqrt(1 - var(vg) - var(v2) - var(prs))): NAs produced</code></pre>
</div>
</div>
<div class="cell" data-hash="2022-12-09-mz-variance_cache/html/unnamed-chunk-11_3044c49cf9d3db892bb1db67ed27b4a0">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(res2, <span class="fu">aes</span>(<span class="at">x=</span>beta2, <span class="at">y=</span><span class="sc">-</span><span class="fu">log10</span>(<span class="st">`</span><span class="at">Pr(&gt;|t|)</span><span class="st">`</span>))) <span class="sc">+</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">colour=</span>method)) <span class="sc">+</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> h2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2022-12-09-mz-variance_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>It looks like youâ€™d just be better off with estimation in populations.</p>
</section>
<section id="type-1-error" class="level2">
<h2 class="anchored" data-anchor-id="type-1-error">Type 1 error</h2>
<div class="cell" data-hash="2022-12-09-mz-variance_cache/html/unnamed-chunk-12_d7c7fd1dbae421650c46c6d43a5df48d">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta1 =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="at">by=</span><span class="fl">0.002</span>),</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta2 =</span> <span class="dv">0</span>,</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">h2 =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>),</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">af =</span> <span class="fl">0.32</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(param)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 502   4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>res3 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(param), <span class="cf">function</span>(i)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  a1 <span class="ot">&lt;-</span> <span class="fu">do.call</span>(sim_mz, param[i,] <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">n=</span><span class="dv">10000</span>))</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  a2 <span class="ot">&lt;-</span> <span class="fu">do.call</span>(sim_mz, param[i,] <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">n=</span><span class="dv">500000</span>))</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">any</span>(<span class="fu">is.na</span>(a1<span class="sc">$</span>y1)) <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(a1<span class="sc">$</span>y2)) <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(a2<span class="sc">$</span>y1)) <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(a2<span class="sc">$</span>y2)))</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">test_mz</span>(a1<span class="sc">$</span>g, a1<span class="sc">$</span>y1, a1<span class="sc">$</span>y2),</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">test_drm</span>(a2<span class="sc">$</span>g, a2<span class="sc">$</span>y1)</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_cols</span>(., param[i,])</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">%&gt;%</span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Plot type 1 error</p>
<div class="cell" data-hash="2022-12-09-mz-variance_cache/html/unnamed-chunk-13_7d7652c48d84c537daddf98850d7f28e">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(res3, <span class="fu">aes</span>(<span class="at">x=</span>beta1, <span class="at">y=</span><span class="sc">-</span><span class="fu">log10</span>(<span class="st">`</span><span class="at">Pr(&gt;|t|)</span><span class="st">`</span>))) <span class="sc">+</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">colour=</span>method)) <span class="sc">+</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> h2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2022-12-09-mz-variance_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Type 1 error and number of false positives after multiple testing correction</p>
<div class="cell" data-hash="2022-12-09-mz-variance_cache/html/unnamed-chunk-14_3e3a2c2ea9c44fb3002354d44de88d69">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>res3 <span class="sc">%&gt;%</span> </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fdr=</span><span class="fu">p.adjust</span>(<span class="st">`</span><span class="at">Pr(&gt;|t|)</span><span class="st">`</span>, <span class="st">"fdr"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(method, h2) <span class="sc">%&gt;%</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">t1 =</span> <span class="fu">sum</span>(<span class="st">`</span><span class="at">Pr(&gt;|t|)</span><span class="st">`</span> <span class="sc">&lt;</span> <span class="fl">0.05</span>, <span class="at">na.rm=</span>T)<span class="sc">/</span><span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="st">`</span><span class="at">Pr(&gt;|t|)</span><span class="st">`</span>)),</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">nfdr =</span> <span class="fu">sum</span>(fdr <span class="sc">&lt;</span> <span class="fl">0.05</span>)<span class="sc">/</span><span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="st">`</span><span class="at">Pr(&gt;|t|)</span><span class="st">`</span>))</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'method'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 Ã— 4
# Groups:   method [2]
  method    h2     t1  nfdr
  &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
1 drm      0.1 0.0637     0
2 drm      0.9 0.0478     0
3 mzdiff   0.1 0.0558     0
4 mzdiff   0.9 0.0757     0</code></pre>
</div>
</div>
<p>Under normal distribution type-1 error rate is well controlled.</p>
</section>
<section id="simulations-using-siblings" class="level2">
<h2 class="anchored" data-anchor-id="simulations-using-siblings">Simulations using siblings</h2>
<p>Generate a set of sib pairs with the following specification</p>
<ul>
<li><p>Have PRS such that IBD ~ N(0.5, sqrt(0.037))</p></li>
<li><p>h2 specified</p></li>
<li><p>ce specified (shared variance between sibs</p></li>
<li><p>one SNP has a mean and variance effect</p></li>
<li><p>scaled phenotypes ~ N(0, 1)</p></li>
</ul>
<div class="cell" data-hash="2022-12-09-mz-variance_cache/html/unnamed-chunk-15_ee45c33d82ea5f752ec437d7ed064b3a">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>sim_sibs <span class="ot">&lt;-</span> <span class="cf">function</span>(af, nfam, beta1, beta2, h2, c2)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Choose number of SNPs to be expected number of recombination events</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># in order to give appropriate distribution of IBD</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>    nsnp <span class="ot">&lt;-</span> <span class="dv">87</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>    af <span class="ot">&lt;-</span> <span class="fu">rep</span>(af, nsnp)</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>    dads <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, nfam, nsnp)</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>    mums <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, nfam, nsnp)</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>    sibs1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, nfam, nsnp)</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>    sibs2 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, nfam, nsnp)</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>    ibd <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, nfam, nsnp)</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>    ibs <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, nfam, nsnp)</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsnp)</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>        dad1 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(nfam, <span class="dv">1</span>, af[i]) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>        dad2 <span class="ot">&lt;-</span> (<span class="fu">rbinom</span>(nfam, <span class="dv">1</span>, af[i]) <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>        mum1 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(nfam, <span class="dv">1</span>, af[i]) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>        mum2 <span class="ot">&lt;-</span> (<span class="fu">rbinom</span>(nfam, <span class="dv">1</span>, af[i]) <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>        dadindex <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>), nfam, <span class="at">replace=</span><span class="cn">TRUE</span>)</span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>        dadh <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, nfam)</span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>        dadh[dadindex] <span class="ot">&lt;-</span> dad1[dadindex]</span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>        dadh[<span class="sc">!</span>dadindex] <span class="ot">&lt;-</span> dad2[<span class="sc">!</span>dadindex]</span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>        mumindex <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>), nfam, <span class="at">replace=</span><span class="cn">TRUE</span>)</span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>        mumh <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, nfam)</span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a>        mumh[mumindex] <span class="ot">&lt;-</span> mum1[mumindex]</span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a>        mumh[<span class="sc">!</span>mumindex] <span class="ot">&lt;-</span> mum2[<span class="sc">!</span>mumindex]</span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a>        sib1 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(dadh, mumh)</span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a>        dadindex <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>), nfam, <span class="at">replace=</span><span class="cn">TRUE</span>)</span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a>        dadh <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, nfam)</span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true" tabindex="-1"></a>        dadh[dadindex] <span class="ot">&lt;-</span> dad1[dadindex]</span>
<span id="cb52-35"><a href="#cb52-35" aria-hidden="true" tabindex="-1"></a>        dadh[<span class="sc">!</span>dadindex] <span class="ot">&lt;-</span> dad2[<span class="sc">!</span>dadindex]</span>
<span id="cb52-36"><a href="#cb52-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-37"><a href="#cb52-37" aria-hidden="true" tabindex="-1"></a>        mumindex <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>), nfam, <span class="at">replace=</span><span class="cn">TRUE</span>)</span>
<span id="cb52-38"><a href="#cb52-38" aria-hidden="true" tabindex="-1"></a>        mumh <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, nfam)</span>
<span id="cb52-39"><a href="#cb52-39" aria-hidden="true" tabindex="-1"></a>        mumh[mumindex] <span class="ot">&lt;-</span> mum1[mumindex]</span>
<span id="cb52-40"><a href="#cb52-40" aria-hidden="true" tabindex="-1"></a>        mumh[<span class="sc">!</span>mumindex] <span class="ot">&lt;-</span> mum2[<span class="sc">!</span>mumindex]</span>
<span id="cb52-41"><a href="#cb52-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-42"><a href="#cb52-42" aria-hidden="true" tabindex="-1"></a>        sib2 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(dadh, mumh)</span>
<span id="cb52-43"><a href="#cb52-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-44"><a href="#cb52-44" aria-hidden="true" tabindex="-1"></a>        ibd[,i] <span class="ot">&lt;-</span> (<span class="fu">as.numeric</span>(sib1[,<span class="dv">1</span>] <span class="sc">==</span> sib2[,<span class="dv">1</span>]) <span class="sc">+</span> <span class="fu">as.numeric</span>(sib1[,<span class="dv">2</span>] <span class="sc">==</span> sib2[,<span class="dv">2</span>])) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb52-45"><a href="#cb52-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-46"><a href="#cb52-46" aria-hidden="true" tabindex="-1"></a>        sibs1[,i] <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(<span class="fu">abs</span>(sib1) <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb52-47"><a href="#cb52-47" aria-hidden="true" tabindex="-1"></a>        sibs2[,i] <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(<span class="fu">abs</span>(sib2) <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb52-48"><a href="#cb52-48" aria-hidden="true" tabindex="-1"></a>        dads[,i] <span class="ot">&lt;-</span> dad1 <span class="sc">-</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fu">abs</span>(dad2) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb52-49"><a href="#cb52-49" aria-hidden="true" tabindex="-1"></a>        mums[,i] <span class="ot">&lt;-</span> mum1 <span class="sc">-</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fu">abs</span>(mum2) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb52-50"><a href="#cb52-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-51"><a href="#cb52-51" aria-hidden="true" tabindex="-1"></a>        <span class="co"># l[[i]] &lt;- (sum(sib1[,1] == sib2[,1]) / nsnp + sum(sib1[,2] == sib2[,2]) / nsnp) / 2</span></span>
<span id="cb52-52"><a href="#cb52-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-53"><a href="#cb52-53" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb52-54"><a href="#cb52-54" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">&lt;-</span> nfam</span>
<span id="cb52-55"><a href="#cb52-55" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Make phenotypes</span></span>
<span id="cb52-56"><a href="#cb52-56" aria-hidden="true" tabindex="-1"></a>    ce <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="fu">sqrt</span>(c2))</span>
<span id="cb52-57"><a href="#cb52-57" aria-hidden="true" tabindex="-1"></a>    v1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, beta2 <span class="sc">*</span> sibs1[,<span class="dv">1</span>])</span>
<span id="cb52-58"><a href="#cb52-58" aria-hidden="true" tabindex="-1"></a>    v2 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, beta2 <span class="sc">*</span> sibs2[,<span class="dv">1</span>])</span>
<span id="cb52-59"><a href="#cb52-59" aria-hidden="true" tabindex="-1"></a>    e1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">-</span> h2 <span class="sc">-</span> c2 <span class="sc">-</span> <span class="fu">var</span>(v1)))</span>
<span id="cb52-60"><a href="#cb52-60" aria-hidden="true" tabindex="-1"></a>    e2 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">-</span> h2 <span class="sc">-</span> c2 <span class="sc">-</span> <span class="fu">var</span>(v2)))</span>
<span id="cb52-61"><a href="#cb52-61" aria-hidden="true" tabindex="-1"></a>    b <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(nsnp<span class="dv">-1</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb52-62"><a href="#cb52-62" aria-hidden="true" tabindex="-1"></a>    h2_1 <span class="ot">&lt;-</span> beta1<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> af[<span class="dv">1</span>] <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>af[<span class="dv">1</span>]) <span class="sc">*</span> <span class="dv">2</span></span>
<span id="cb52-63"><a href="#cb52-63" aria-hidden="true" tabindex="-1"></a>    h2_res <span class="ot">&lt;-</span> h2 <span class="sc">-</span> h2_1</span>
<span id="cb52-64"><a href="#cb52-64" aria-hidden="true" tabindex="-1"></a>    prs1 <span class="ot">&lt;-</span> <span class="fu">scale</span>(sibs1[,<span class="sc">-</span><span class="dv">1</span>] <span class="sc">%*%</span> b) <span class="sc">*</span> <span class="fu">sqrt</span>(h2_res)</span>
<span id="cb52-65"><a href="#cb52-65" aria-hidden="true" tabindex="-1"></a>    prs2 <span class="ot">&lt;-</span> <span class="fu">scale</span>(sibs2[,<span class="sc">-</span><span class="dv">1</span>] <span class="sc">%*%</span> b) <span class="sc">*</span> <span class="fu">sqrt</span>(h2_res)</span>
<span id="cb52-66"><a href="#cb52-66" aria-hidden="true" tabindex="-1"></a>    y1 <span class="ot">&lt;-</span> sibs1[,<span class="dv">1</span>] <span class="sc">*</span> beta1 <span class="sc">+</span> prs1 <span class="sc">+</span> v1 <span class="sc">+</span> ce <span class="sc">+</span> e1</span>
<span id="cb52-67"><a href="#cb52-67" aria-hidden="true" tabindex="-1"></a>    y2 <span class="ot">&lt;-</span> sibs2[,<span class="dv">1</span>] <span class="sc">*</span> beta1 <span class="sc">+</span> prs2 <span class="sc">+</span> v2 <span class="sc">+</span> ce <span class="sc">+</span> e2</span>
<span id="cb52-68"><a href="#cb52-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">tibble</span>(</span>
<span id="cb52-69"><a href="#cb52-69" aria-hidden="true" tabindex="-1"></a>      <span class="at">ibd =</span> <span class="fu">rowMeans</span>(ibd),</span>
<span id="cb52-70"><a href="#cb52-70" aria-hidden="true" tabindex="-1"></a>      <span class="at">g1 =</span> sibs1[,<span class="dv">1</span>],</span>
<span id="cb52-71"><a href="#cb52-71" aria-hidden="true" tabindex="-1"></a>      <span class="at">g2 =</span> sibs2[,<span class="dv">1</span>],</span>
<span id="cb52-72"><a href="#cb52-72" aria-hidden="true" tabindex="-1"></a>      prs1,</span>
<span id="cb52-73"><a href="#cb52-73" aria-hidden="true" tabindex="-1"></a>      prs2,</span>
<span id="cb52-74"><a href="#cb52-74" aria-hidden="true" tabindex="-1"></a>      y1, </span>
<span id="cb52-75"><a href="#cb52-75" aria-hidden="true" tabindex="-1"></a>      y2</span>
<span id="cb52-76"><a href="#cb52-76" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb52-77"><a href="#cb52-77" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notes</p>
<ul>
<li><p>In this model if the allele frequency is higher, then the genotype class with the larger variance is more common, which means that effect alleles are not reflexive in terms of variances</p></li>
<li><p>I think this use with siblings may have problems due to LD. If there is incomplete LD with another causal variant elsewhere close by then the mean effect of that causal variant will contribute to the variance effect estimated at the variant</p></li>
</ul>
<div class="cell" data-hash="2022-12-09-mz-variance_cache/html/unnamed-chunk-16_fe41923259d85764dfa35bfa974015a8">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>fam <span class="ot">&lt;-</span> <span class="fu">sim_sibs</span>(<span class="fl">0.3</span>, <span class="dv">10000</span>, <span class="fl">0.1</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.1</span>)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(fam) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         ibd      g1     g2    prs1    prs2     y1     y2
ibd   1.0000 -0.0020 0.0068 -0.0063 -0.0045 0.0054 0.0077
g1   -0.0020  1.0000 0.5061  0.0085  0.0212 0.0649 0.0551
g2    0.0068  0.5061 1.0000  0.0089  0.0076 0.0329 0.0665
prs1 -0.0063  0.0085 0.0089  1.0000  0.4877 0.7760 0.3816
prs2 -0.0045  0.0212 0.0076  0.4877  1.0000 0.3818 0.7721
y1    0.0054  0.0649 0.0329  0.7760  0.3818 1.0000 0.4011
y2    0.0077  0.0551 0.0665  0.3816  0.7721 0.4011 1.0000</code></pre>
</div>
</div>
<p>Now how to estimate variance effect? At a locus restrict to sib pairs who are IBD = 1</p>
<div class="cell" data-hash="2022-12-09-mz-variance_cache/html/unnamed-chunk-17_b4daf1a0ef1952a61f9e56137960c837">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>fam <span class="ot">&lt;-</span> <span class="fu">sim_sibs</span>(<span class="at">af=</span><span class="fl">0.5</span>, <span class="at">nfam=</span><span class="dv">40000</span>, <span class="at">beta1=</span><span class="fl">0.1</span>, <span class="at">beta2=</span><span class="fl">0.2</span>, <span class="at">h2=</span><span class="fl">0.3</span>, <span class="at">c2=</span><span class="fl">0.1</span>)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>fam</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 40,000 Ã— 7
     ibd    g1    g2 prs1[,1] prs2[,1]  y1[,1] y2[,1]
   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
 1 0.477     1     1 -0.333      0.360 -0.244   0.210
 2 0.437     2     2 -0.376     -0.516 -0.455   0.164
 3 0.511     1     1  0.0654    -0.613  0.247  -1.47 
 4 0.523     2     1  0.652      0.371  1.14    0.728
 5 0.506     0     0 -0.0106     0.456  0.0296  0.410
 6 0.483     1     2  0.0979     0.391  1.84    1.66 
 7 0.471     1     2  0.0902     0.495  0.0733 -0.518
 8 0.460     1     1 -0.451     -0.160 -0.941   0.344
 9 0.511     1     0  0.734      0.532  1.73    0.803
10 0.477     1     0  0.00962   -0.546  1.15   -0.801
# â€¦ with 39,990 more rows</code></pre>
</div>
</div>
<p>Test for variance QTL</p>
<div class="cell" data-hash="2022-12-09-mz-variance_cache/html/unnamed-chunk-18_b0152ba30cb588db6a8918b2e7f1c39b">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>fam <span class="ot">&lt;-</span> <span class="fu">sim_sibs</span>(<span class="at">af=</span><span class="fl">0.5</span>, <span class="at">nfam=</span><span class="dv">40000</span>, <span class="at">beta1=</span><span class="fl">0.1</span>, <span class="at">beta2=</span><span class="fl">0.2</span>, <span class="at">h2=</span><span class="fl">0.01</span>, <span class="at">c2=</span><span class="fl">0.01</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>f1 <span class="ot">&lt;-</span> <span class="fu">subset</span>(fam, g1<span class="sc">==</span>g2)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="fu">test_mz</span>(f1<span class="sc">$</span>g1, f1<span class="sc">$</span>y1, f1<span class="sc">$</span>y2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 Ã— 5
  Estimate `Std. Error` `t value` `Pr(&gt;|t|)` method
     &lt;dbl&gt;        &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt; 
1   0.0535      0.00795      6.73   1.78e-11 mzdiff</code></pre>
</div>
</div>
<p>Power sims</p>
<div class="cell" data-hash="2022-12-09-mz-variance_cache/html/unnamed-chunk-19_1db943ea1d05e75f42dbf73ec0c33f94">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>param <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta1 =</span> <span class="dv">0</span>,</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta2 =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="at">by=</span><span class="fl">0.01</span>),</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">c2 =</span> <span class="fu">c</span>(<span class="dv">0</span>),</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">h2 =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.5</span>),</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">af =</span> <span class="fu">c</span>(<span class="fl">0.5</span>)</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(param)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 102   5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>res4 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(param), <span class="cf">function</span>(i)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  a1 <span class="ot">&lt;-</span> <span class="fu">do.call</span>(sim_sibs, param[i,] <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">nfam=</span><span class="dv">22000</span>))</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  a2 <span class="ot">&lt;-</span> <span class="fu">do.call</span>(sim_pop, param[i,] <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(c2)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">n=</span><span class="dv">500000</span>))</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">any</span>(<span class="fu">is.na</span>(a1<span class="sc">$</span>y1)) <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(a1<span class="sc">$</span>y2)) <span class="sc">|</span> <span class="fu">any</span>(<span class="fu">is.na</span>(a2<span class="sc">$</span>y)))</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>    a1 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(g1<span class="sc">==</span>g2) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="at">g=</span>g1, y1, y2) <span class="sc">%&gt;%</span> <span class="fu">do.call</span>(test_mz, .),</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">do.call</span>(test_drm, a2)</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_cols</span>(., param[i,])</span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">%&gt;%</span></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="2022-12-09-mz-variance_cache/html/unnamed-chunk-20_664b4b686c19e40169cc98b1c09dbe27">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>res4 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">sharing=</span>c2<span class="sc">+</span>h2) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(beta1<span class="sc">==</span><span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(., <span class="fu">aes</span>(<span class="at">x=</span>beta2, <span class="at">y=</span><span class="sc">-</span><span class="fu">log10</span>(<span class="st">`</span><span class="at">Pr(&gt;|t|)</span><span class="st">`</span>))) <span class="sc">+</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">colour=</span>method, <span class="at">groups=</span>af)) <span class="sc">+</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> sharing)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in geom_line(aes(colour = method, groups = af)): Ignoring unknown
aesthetics: groups</code></pre>
</div>
<div class="cell-output-display">
<p><img src="2022-12-09-mz-variance_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Similar to MZ method - quite a substantial benefit from leveraging large sample sizes of unrelateds compared to using siblings.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>